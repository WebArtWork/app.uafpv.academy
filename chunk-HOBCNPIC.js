import{a as I}from"./chunk-W2HDGUYG.js";import{a as k}from"./chunk-C7TNO6B4.js";import{h as A}from"./chunk-R3HM3236.js";import{$a as w,Ab as b,Cb as x,O as r,P as u,Q as d,T as p,W as f,Xa as v,aa as _,gb as C,ib as g,mb as y,sb as S,u as m}from"./chunk-2Y7ZGU6E.js";var L={formId:"schoollesson",title:"Schoollesson",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill schoollesson title"},{name:"Label",value:"Title"}]},{name:"Text",key:"shortDescription",fields:[{name:"Placeholder",value:"fill lesson short description"},{name:"Label",value:"Short description"}]},{name:"Html",key:"description",fields:[{name:"Placeholder",value:"fill schoollesson description"},{name:"Label",value:"Description"},{name:"Textarea",value:!0}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill schoollesson description"},{name:"Label",value:"Description"},{name:"Textarea",value:!0}]},{name:"Tags",key:"links",fields:[{name:"Placeholder",value:"add lessons links"},{name:"Label",value:"Links"}]}]};var c=(()=>{class s extends g{get rows(){return this.course?this._schoollessonService.schoollessonsByCourse[this.course]:this._schoollessonService.schoollessonsByAuthor[this._us.user._id]}get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}constructor(t,i,l,a,h,T,j){super(t,h,a),this._schoollessonService=t,this._translate=i,this._alert=l,this._form=a,this._core=h,this._router=T,this._us=j,this.columns=["name"],this.course=this._router.url.includes("/lessons/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoollesson",L),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(e,n)=>{this.preCreate(e),this._schoollessonService.create(e),n()}})}:null,update:this.hasAccess?e=>{this._form.modal(this.form,[],e).then(n=>{this._core.copy(n,e),this._schoollessonService.update(e)})}:null,delete:this.hasAccess?e=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoollesson?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoollessonService.delete(e)}}]})}:null,buttons:[this.hasAccess?{icon:"arrow_upward",click:e=>{let n=this.rows.findIndex(o=>o._id===e._id);n&&(this.rows.splice(n,1),this.rows.splice(n-1,0,e));for(let o=0;o<this.rows.length;o++)this.rows[o].order!==o&&(this.rows[o].order=o,this._schoollessonService.update(this.rows[o]))}}:null,this.hasAccess?{icon:"cloud_download",click:e=>{this._form.modalUnique("schoollesson","url",e)}}:null,{icon:"assignment",hrefFunc:e=>this._roleUrl()+"tests/lesson/"+e._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this.bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this.bulkManagement(!1),class:"edit"}:null]}}preCreate(t){delete t.__created,this.course&&(t.course=this.course)}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}static{this.\u0275fac=function(i){return new(i||s)(r(I),r(S),r(y),r(x),r(C),r(v),r(k))}}static{this.\u0275cmp=u({type:s,selectors:[["ng-component"]],standalone:!1,features:[p],decls:1,vars:3,consts:[["title","Lessons",3,"columns","config","rows"]],template:function(i,l){i&1&&_(0,"wtable",0),i&2&&f("columns",l.columns)("config",l.config)("rows",l.rows)},dependencies:[b],encapsulation:2})}}return s})();var F=[{path:"",component:c},{path:":course",component:c}],O=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=d({type:s})}static{this.\u0275inj=m({imports:[w.forChild(F),A]})}}return s})();export{O as LessonsModule};
