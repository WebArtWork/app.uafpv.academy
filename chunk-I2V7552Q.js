import{a as F}from"./chunk-CKK4Q5R4.js";import{a as I}from"./chunk-C7TNO6B4.js";import{e as A,h as D}from"./chunk-R3HM3236.js";import{$ as _,$a as w,Ab as M,Cb as x,O as r,P as m,Q as u,U as d,W as p,Xa as g,_ as f,fa as v,gb as y,mb as b,oa as S,qa as C,sb as j,u as h,zb as k}from"./chunk-2Y7ZGU6E.js";var N={formId:"schoolsession",title:"Session",components:[{name:"Date",key:"start",fields:[{name:"Placeholder",value:"fill session start"},{name:"Label",value:"Date start"}]},{name:"Date",key:"end",fields:[{name:"Placeholder",value:"fill session end"},{name:"Label",value:"Date end"}]}]};function P(t,T){if(t&1&&S(0),t&2){let s=T.$implicit,o=v();C(" ",o.courseName(s.course)," ")}}var a=(()=>{class t{get hasAccess(){return!!this.course&&(this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher"))}get rows(){return this.course?this._schoolsessionService.schoolsessionsByCourse[this.course]:this._schoolsessionService.schoolsessions}constructor(s,o,e,n,c,U,q,B){this._translate=s,this._schoolsessionService=o,this._schoolcourseService=e,this._alert=n,this._form=c,this._core=U,this._router=q,this._us=B,this.columns=["course","status","start","end"],this.course=this._router.url.includes("/sessions/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoolsession",N),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(i,l)=>{this._preCreate(i),this._schoolsessionService.create(i),l()}})}:null,update:this.hasAccess?i=>{this._form.modal(this.form,[],i).then(l=>{this._core.copy(l,i),this._schoolsessionService.update(i)})}:null,delete:this.hasAccess?i=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoolsession?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoolsessionService.delete(i)}}]})}:null,buttons:[this.hasAccess?{icon:"cloud_download",click:i=>{this._form.modalUnique("schoolsession","url",i)}}:null,{icon:"card_membership",hrefFunc:i=>this._roleUrl()+"certificates/session/"+i._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]}}courseName(s){return this._schoolcourseService.doc(s).name}_bulkManagement(s=!0){return()=>{this._form.modalDocs(s?[]:this.rows).then(o=>{if(s)for(let e of o)this._preCreate(e),this._schoolsessionService.create(e);else{for(let e of this.rows)o.find(n=>n._id===e._id)||this._schoolsessionService.delete(e);for(let e of o){let n=this.rows.find(c=>c._id===e._id);n?(this._core.copy(e,n),this._schoolsessionService.update(n)):(this._preCreate(e),this._schoolsessionService.create(e))}}})}}_preCreate(s){delete s.__created,s.course=this.course}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}static{this.\u0275fac=function(o){return new(o||t)(r(j),r(F),r(A),r(b),r(x),r(y),r(g),r(I))}}static{this.\u0275cmp=m({type:t,selectors:[["ng-component"]],standalone:!1,decls:2,vars:3,consts:[["title","Sessions",3,"columns","config","rows"],["cell","course"]],template:function(o,e){o&1&&(f(0,"wtable",0),d(1,P,1,1,"ng-template",1),_()),o&2&&p("columns",e.columns)("config",e.config)("rows",e.rows)},dependencies:[M,k],encapsulation:2})}}return t})();var R=[{path:"",component:a},{path:":course",component:a}],se=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=u({type:t})}static{this.\u0275inj=h({imports:[w.forChild(R),D]})}}return t})();export{se as SessionsModule};
