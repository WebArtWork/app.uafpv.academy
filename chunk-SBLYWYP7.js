import{a as O}from"./chunk-KWWNFWCU.js";import{a as B}from"./chunk-C7TNO6B4.js";import{h as R}from"./chunk-R3HM3236.js";import{$ as m,$a as j,A as p,Ab as N,Cb as w,Db as E,Ja as S,Ka as F,L as A,O as r,P as f,Q as q,U as g,W as c,Xa as Q,_ as a,a as y,aa as I,da as x,ea as u,fa as l,gb as v,lb as M,mb as L,oa as _,ob as P,sb as V,u as k,vb as D,z as d}from"./chunk-2Y7ZGU6E.js";var U={formId:"schooltest",title:"Schooltest",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill tests title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill tests description"},{name:"Label",value:"Description"}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set tests duration"},{name:"Label",value:"Duration"}]}]};function K(o,b){if(o&1){let e=x();a(0,"wform",3),u("wChange",function(){d(e);let s=l(2);return p(s.change())}),m()}if(o&2){let e=l().$implicit,t=l();c("submition",e)("config",t.form)}}function X(o,b){if(o&1){let e=x();a(0,"div")(1,"wbutton",1),u("click",function(){let s=d(e).index,n=l();return n.questionIndex=s,p(n.change())}),_(2,"Edit question"),m(),g(3,K,1,2,"wform",2),a(4,"wbutton",1),u("click",function(){let s=d(e).index,n=l();return n.test.questions.splice(s,1),p(n.update())}),_(5,"Remove question"),m()()}if(o&2){let e=b.index,t=l();A(3),c("ngIf",t.questionIndex===e)}}var H=(()=>{class o{get questions(){return this.test.questions}constructor(e,t,s){this._form=e,this._core=t,this._http=s,this.questionIndex=0,this.form=this._form.getForm("testQuestions",{formId:"testQuestions",title:"Question",components:[{name:"Text",key:"question",focused:!0,fields:[{name:"Placeholder",value:"fill questions text"},{name:"Label",value:"Text"}]},{name:"Select",key:"type",fields:[{name:"Placeholder",value:"select questions type"},{name:"Label",value:"Type"},{name:"Items",value:["Text","Radio","Checkbox","ArrayTexts","TwoArrayConnects"]}]},{name:"Tags",key:"answers",hidden:!0,fields:[{name:"Button",value:"Add answers"},{name:"Placeholder",value:"fill questions answers"},{name:"Label",value:"Answers"}]},{name:"Tags",key:"connectTo",hidden:!0,fields:[{name:"Button",value:"Add connectTo"},{name:"Placeholder",value:"fill questions connections"},{name:"Label",value:"ConnectTo"}]},{name:"Text",key:"text",hidden:!0,fields:[{name:"Placeholder",value:"fill answer text"},{name:"Label",value:"Answer"}]},{name:"Text",key:"radio",hidden:!0,fields:[{name:"Button",value:"Add correct answer"},{name:"Placeholder",value:"fill correct answer"},{name:"Label",value:"Correct Answer"}]},{name:"Tags",key:"checkboxes",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"arrayTexts",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"twoArrayConnects",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]}]})}ngOnInit(){this.change(),this._http.post("/api/school/test/get",this.test,e=>{if(e)for(let t=0;t<this.test.questions.length;t++)this.test.questions[t]=y(y({},this.test.questions[t]),e.answers[t])})}change(){let e=this.questions[this.questionIndex];this.form.components[2].hidden=!e.type||e.type==="Text",this.form.components[3].hidden=e.type!=="TwoArrayConnects",this.form.components[4].hidden=e.type!=="Text",this.form.components[5].hidden=e.type!=="Radio",this.form.components[6].hidden=e.type!=="Checkbox",this.form.components[7].hidden=e.type!=="ArrayTexts",this.form.components[8].hidden=e.type!=="TwoArrayConnects",this.updateAfterWhile()}addQuestion(){this.test.questions.push({}),this.change()}update(){this._http.post("/api/school/test/update",this.test)}updateAfterWhile(){this._core.afterWhile("question",this.update.bind(this),2e3)}static{this.\u0275fac=function(t){return new(t||o)(r(w),r(v),r(M))}}static{this.\u0275cmp=f({type:o,selectors:[["app-test-questions"]],standalone:!1,decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"click"],[3,"submition","config","wChange",4,"ngIf"],[3,"wChange","submition","config"]],template:function(t,s){t&1&&(g(0,X,6,1,"div",0),a(1,"wbutton",1),u("click",function(){return s.addQuestion()}),_(2,"Add question"),m()),t&2&&c("ngForOf",s.questions)},dependencies:[S,F,D,E],encapsulation:2})}}return o})();var h=(()=>{class o{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.moduleType?this._schooltestService.byId[this.moduleType][this.moduleId]:this._schooltestService.schooltests}constructor(e,t,s,n,C,Y,$,z){this._translate=e,this._schooltestService=t,this._alert=s,this._form=n,this._core=C,this._router=Y,this._modal=$,this._us=z,this.columns=["_id","title","duration"],this.moduleType=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-2]:"",this.moduleId=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schooltest",U),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(i,T)=>{this._preCreate(i),this._schooltestService.create(i),T()}})}:null,update:this.hasAccess?i=>{this._form.modal(this.form,[],i).then(T=>{this._core.copy(T,i),this._schooltestService.update(i)})}:null,delete:this.hasAccess?i=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schooltest?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schooltestService.delete(i)}}]})}:null,buttons:[this.hasAccess?{icon:"assignment_turned_in",click:i=>{i.questions=i.questions||[],this._modal.show({component:H,test:i})}}:null,this.hasAccess?{icon:"cloud_download",click:i=>{this._form.modalUnique("tests","url",i)}}:null,{icon:"card_membership",hrefFunc:i=>this._roleUrl()+"certificates/test/"+i._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]}}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(t=>{if(e)for(let s of t)this._preCreate(s),this._schooltestService.create(s);else{for(let s of this.rows)t.find(n=>n._id===s._id)||this._schooltestService.delete(s);for(let s of t){let n=this.rows.find(C=>C._id===s._id);n?(this._core.copy(s,n),this._schooltestService.update(n)):(this._preCreate(s),this._schooltestService.create(s))}}})}}_preCreate(e){switch(delete e.__created,this.moduleType){case"course":e.course=this.moduleId;break;case"lesson":e.lesson=this.moduleId;break;case"school":e.school=this.moduleId;break}}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}static{this.\u0275fac=function(t){return new(t||o)(r(V),r(O),r(L),r(w),r(v),r(Q),r(P),r(B))}}static{this.\u0275cmp=f({type:o,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Tests",3,"columns","config","rows"]],template:function(t,s){t&1&&I(0,"wtable",0),t&2&&c("columns",s.columns)("config",s.config)("rows",s.rows)},dependencies:[N],encapsulation:2})}}return o})();var Z=[{path:"",component:h},{path:"school/:schooltest",component:h},{path:"course/:schooltest",component:h},{path:"lesson/:schooltest",component:h}],Ce=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=q({type:o})}static{this.\u0275inj=k({imports:[j.forChild(Z),R]})}}return o})();export{Ce as TestsModule};
