import{a as A}from"./chunk-GD3PTTLR.js";import{a as S}from"./chunk-C7TNO6B4.js";import{e as I,h as q}from"./chunk-R3HM3236.js";import{$a as g,Ab as k,Cb as b,O as c,P as d,Q as f,W as _,Xa as v,aa as p,gb as C,mb as w,sb as y,u as m}from"./chunk-2Y7ZGU6E.js";var s={formId:"schoolcourse",title:"Schoolcourse",components:[{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Photo"}]},{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill course title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill course description"},{name:"Label",value:"Description"}]},{name:"Select",key:"requiredCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select required \u0441ourse"},{name:"Label",value:"Required Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Select",key:"suggestedCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select suggested \u0441ourse"},{name:"Label",value:"Suggested Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set course duration"},{name:"Label",value:"Duration"}]},{name:"Number",key:"cost",fields:[{name:"Placeholder",value:"set course cost"},{name:"Label",value:"Cost"}]},{name:"Tags",key:"learning",fields:[{name:"Button",value:"Add what we are learning"},{name:"Placeholder",value:"fill learnings"},{name:"Label",value:"What student will learn"}]},{name:"Tags",key:"included",fields:[{name:"Button",value:"Add what is included"},{name:"Placeholder",value:"fill included"},{name:"Label",value:"Included"}]},{name:"Tags",key:"requirements",fields:[{name:"Button",value:"Add what is required to know"},{name:"Placeholder",value:"fill requirements"},{name:"Label",value:"Requirements"}]},{name:"Select",key:"status",fields:[{name:"Items",value:["Active","Inactive"]},{name:"Placeholder",value:"choose course status"},{name:"Label",value:"Status"},{name:"Multiple",value:!1}]},{name:"Select",key:"knowledge",hidden:!0,fields:[{name:"Items",value:[]},{name:"Placeholder",value:"choose course knowledge"},{name:"Label",value:"Knowledge"},{name:"Name",value:"title"}]}]};var h=(()=>{class r{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.school?this._schoolcourseService.schoolcoursesBySchool[this.school]:this._schoolcourseService.schoolcoursesByAuthor[this._us.user._id]}constructor(i,t,o,n,u,M,P,B){this._schoolcourseService=i,this._schoolknowledge=t,this._translate=o,this._alert=n,this._form=u,this._core=M,this._router=P,this._us=B,this.columns=["name","duration","cost","status"],this.school=this._router.url.includes("/courses/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoolcourse",s),this.config={create:this.hasAccess?()=>{this.school||(this._form.getComponent(s,"suggestedCourse").hidden=!0,this._form.getComponent(s,"requiredCourse").hidden=!0),this._form.modal(this.form,{label:"Create",click:(e,a)=>{this._preCreate(e),this._schoolcourseService.create(e),a()}})}:null,update:this.hasAccess?e=>{this.school||(e.school?(this._form.getComponent(s,"suggestedCourse").hidden=!1,this._form.setValue(s,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[e.school]),this._form.getComponent(s,"requiredCourse").hidden=!1,this._form.setValue(s,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[e.school])):(this._form.getComponent(s,"suggestedCourse").hidden=!0,this._form.getComponent(s,"requiredCourse").hidden=!0)),this._form.modal(this.form,[],e).then(a=>{this._core.copy(a,e),this._schoolcourseService.update(e)})}:null,delete:this.hasAccess?e=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoolcourse?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoolcourseService.delete(e)}}]})}:null,buttons:[this.hasAccess?{icon:"arrow_upward",click:e=>{let a=this.rows.findIndex(l=>l._id===e._id);a&&(this.rows.splice(a,1),this.rows.splice(a-1,0,e));for(let l=0;l<this.rows.length;l++)this.rows[l].order!==l&&(this.rows[l].order=l,this._schoolcourseService.update(this.rows[l]))}}:null,this.hasAccess?{icon:"cloud_download",click:e=>{this._form.modalUnique("schoolcourse","url",e)}}:null,{icon:"event",hrefFunc:e=>this._roleUrl()+"sessions/"+e._id},{icon:"work",hrefFunc:e=>this._roleUrl()+"lessons/"+e._id},{icon:"assignment",hrefFunc:e=>this._roleUrl()+"tests/course/"+e._id},{icon:"card_membership",hrefFunc:e=>this._roleUrl()+"certificates/course/"+e._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]},this.onKnowledge=this._core.on("schoolknowledge_get").subscribe(()=>{this.school&&(s.components[5].hidden=!1,s.components[5].fields[0].value.push(...this._schoolknowledge.schoolknowledgesBySchool[this.school]))}),this._core.onComplete("schoolcourse_loaded").then(()=>{this.school&&(this._form.getComponent(s,"suggestedCourse").hidden=!1,this._form.setValue(s,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]),this._form.getComponent(s,"requiredCourse").hidden=!1,this._form.setValue(s,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]))})}ngOnDestroy(){this.onKnowledge.unsubscribe()}_bulkManagement(i=!0){return()=>{this._form.modalDocs(i?[]:this.rows).then(t=>{if(i)for(let o of t)this._preCreate(o),this._schoolcourseService.create(o);else{for(let o of this.rows)t.find(n=>n._id===o._id)||this._schoolcourseService.delete(o);for(let o of t){let n=this.rows.find(u=>u._id===o._id);n?(this._core.copy(o,n),this._schoolcourseService.update(n)):(this._preCreate(o),this._schoolcourseService.create(o))}}})}}_preCreate(i){delete i.__created,this.school&&(i.school=this.school)}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}static{this.\u0275fac=function(t){return new(t||r)(c(I),c(A),c(y),c(w),c(b),c(C),c(v),c(S))}}static{this.\u0275cmp=d({type:r,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Courses",3,"columns","config","rows"]],template:function(t,o){t&1&&p(0,"wtable",0),t&2&&_("columns",o.columns)("config",o.config)("rows",o.rows)},dependencies:[k],encapsulation:2})}}return r})();var j=[{path:"",component:h},{path:":schoolcourse",component:h}],G=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=f({type:r})}static{this.\u0275inj=m({imports:[g.forChild(j),q]})}}return r})();export{G as CoursesModule};
